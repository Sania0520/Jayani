<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>To Kaviii üíñ</title>
  <link rel="stylesheet" href="style.css"/>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function () {
      emailjs.init("LpQE7uVfrME92_7-7"); // üîπ replace with your EmailJS Public Key
    })();
  </script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

  <style>
    .message-wrapper { display: flex; flex-direction: column; align-items: center; margin: 20px auto; max-width: 100%; padding: 0 10px; }
    .photocard { width: 350px; height: 420px; border-radius: 12px; object-fit: cover; box-shadow: 0 6px 12px rgba(0,0,0,0.3); transform: rotate(-2deg); transition: transform 0.3s ease; }
    .photocard:hover { transform: scale(1.05) rotate(0deg); }
    @media (max-width: 768px) { .photocard { width: 100px; height: 140px; } }
    .top-row { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; }
    .message-row { display: flex; align-items: center; justify-content: center; flex-wrap: nowrap; width: 100%; max-width: 900px; }
    .side-images { display: flex; flex-direction: column; gap: 10px; margin: 0 10px; flex-shrink: 0; }
    form { flex: 1; max-width: 600px; margin: 0 30px; z-index: 2; }
    textarea { width: 500px; height: 120px; padding: 16px; border-radius: 12px; font-size: 1rem; border: 1px solid #ccc; resize: vertical; }
    button { margin-top: 12px; padding: 12px 24px; border-radius: 12px; background: #ff7aa2; color: #fff; border: 0; font-weight: bold; cursor: pointer; }
    @media (max-width: 768px) {
      .message-row { flex-wrap: wrap; }
      .side-images { flex-direction: row; margin: 10px 0; justify-content: center; width: 100%; }
    }
  </style>
</head>

<body class="pastel-bg">
  <h1>For Kaviii, With love üíå</h1>

  <div class="message-wrapper">
    <div class="top-row" id="topImages"></div>
    <div class="message-row">
      <div class="side-images" id="leftImages"></div>
      <form id="messageForm">
        <textarea id="messageInput" rows="4" placeholder="Write something for her....."></textarea>
        <button type="submit">Send</button>
      </form>
      <div class="side-images" id="rightImages"></div>
    </div>
  </div>

  <p id="lyric" style="margin:20px 0; font-weight:600; text-align:center;"></p>

  <audio id="songA" autoplay loop>
    <source src="music/us_again.mp3" type="audio/mpeg"/>
  </audio>

  <div id="messages" style="max-width:520px; margin:0 auto; text-align:left;"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    // üîπ Firebase Config (replace with your project details)
    const firebaseConfig = {
      apiKey: "AIzaSyBPxG_8RjWWACYwk68N-Z7OE9FiA1UR5Uw",
      authDomain: "jayani-8adc3.firebaseapp.com",
      databaseURL: "https://jayani-8adc3-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "jayani-8adc3",
      storageBucket: "jayani-8adc3.firebasestorage.app",
      messagingSenderId: "617889508627",
      appId: "1:617889508627:web:24b538fbf1ae5660a7fee6",
      measurementId: "G-2K9G86MNZ0"

    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // === CONFIG FOR THIS PAGE ===
    const FRIEND_KEY = "Kaviii"; // üîπ change for each friend
    const RECIPIENT_EMAIL = " KwonJayanipriya@gmail.com "; // üîπ friend's email
    const SERVICE_ID = "service_6bm5zo8"; // your EmailJS service ID
    const TEMPLATE_ID = "template_yblrgsm"; // your EmailJS template ID
    const FROM_NAME = "Jayani"; // sender name

    const messagesRef = ref(db, FRIEND_KEY);

    // Random lyric
    const lyrics = [
      "Because we are together, I'm able to smile, because it's you, I'm able to cry, so what can't I do, whenever wherever we are, even if we could not be together just like always, our smile flower will bloom, I'll be the spring to your smile.",
      "You, who dreams the same dream as me and with the same mind, look out upon the same night together with me, even if I'm given everything in the world, I can never exchange it, promise me eternity, if your feelings are the same as mine, no matter what happens, I will be beside you, don't worry.",
      "When you are tired you can share it with me, I'm like that too, always failed to hide what I tried to, you know it too, we can make each other laugh, don't feel sorry, don't you worry, don't be afraid, now stop crying, to me you are very precious, for you who must have it hard today, I will tell you that I am here, that you are done well, that I love you, and I will hug you tight.",
      "It comes, it goes, we are driving down a one way road to something better, something better, and what hurts you is gonna pass, and you will have learnt from it when it comes back, you will be doing better, yeah doing better.",
      "Just keep your head up love, keep your head up, don't hide away, don't ever change, keep your head up love, keep your head up, don't look away, don't look away, cause everybody's looking at you now, my oh my, I guess some queens don't need a crown and I know why, even when your years are falling down, still somehow, you are perfect now.",
      "US, WHATEVER HAPPENS, JUST LIKE ALWAYS, WE'LL BE TOGETHER."
    ];
    document.getElementById("lyric").innerText =
      lyrics[Math.floor(Math.random() * lyrics.length)];

    const form = document.getElementById("messageForm");
    const input = document.getElementById("messageInput");
    const messagesDiv = document.getElementById("messages");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const msg = input.value.trim();
      if (!msg) return;

      const entry = { text: msg, time: new Date().toLocaleString() };

      // 1Ô∏è‚É£ Save to Firebase
      push(messagesRef, entry);

      // 2Ô∏è‚É£ Send hidden email to the friend
      try {
        await emailjs.send(SERVICE_ID, TEMPLATE_ID, {
          to_email: RECIPIENT_EMAIL,
          name: FROM_NAME,
          message: msg,
          time: entry.time
        });
      } catch (err) {
        console.error("EmailJS error:", err);
      }

      input.value = "";
    });

    // Load messages from Firebase
    onChildAdded(messagesRef, (snapshot) => {
      const entry = snapshot.val();
      const p = document.createElement("p");
      p.style.background = "#fff0f6";
      p.style.padding = "10px";
      p.style.borderRadius = "10px";
      p.style.margin = "8px 0";
      p.textContent = `${entry.time} ‚Äî ${entry.text}`;
      messagesDiv.appendChild(p);
    });

    // === Photocard display ===
        // === Photocard display ===
    const imageFolder = "images/kavi/";
    const imageCount = 15; // adjust to your folder count
    function getUniqueRandomImages(totalNeeded) {
      const all = Array.from({ length: imageCount }, (_, i) => `${imageFolder}kavi${i+1}.jpg`);
      for (let i = all.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [all[i], all[j]] = [all[j], all[i]];
      }
      return all.slice(0, totalNeeded);
    }
    function displayImages() {
      const top = document.getElementById("topImages");
      const left = document.getElementById("leftImages");
      const right = document.getElementById("rightImages");
      const chosen = getUniqueRandomImages(6);
      top.innerHTML = chosen.slice(0,2).map(src => `<img src="${src}" class="photocard"/>`).join("");
      left.innerHTML = chosen.slice(2,4).map(src => `<img src="${src}" class="photocard"/>`).join("");
      right.innerHTML = chosen.slice(4,6).map(src => `<img src="${src}" class="photocard"/>`).join("");
    }

    // Initial display
    displayImages();

    // üîÅ Auto cycle every 5 seconds
    setInterval(displayImages, 5000);

  </script>
</body>
</html>
